# Excel工作簿模板结构

## 工作表布局说明

### 1. 宏按钮工作表

#### 最优配方数据区域
```
     G       H       I
14 | X1值  | X2值  | X3值  |  <- 最优配方 (算方结果)
```

#### 目标LAB值区域  
```
     D       E       F
17 | L目标  | A目标  | B目标  |  <- 目标LAB值
```

#### ΔLAB值区域
```
     A       B       C
19 | ΔL     | ΔA     | ΔB     |  <- LAB偏移量
```

### 2. 范围工作表

#### 拟合系数存储区域
系数按以下顺序存储在A列（从A1开始）：

**2阶多项式情况 (30个系数):**
```
A1-A10:   L分量系数 (a0, a1, a2, a3, a4, a5, a6, a7, a8, a9)
A11-A20:  A分量系数 (a0, a1, a2, a3, a4, a5, a6, a7, a8, a9)  
A21-A30:  B分量系数 (a0, a1, a2, a3, a4, a5, a6, a7, a8, a9)
```

**3阶多项式情况 (60个系数):**
```
A1-A20:   L分量系数 (a0-a19)
A21-A40:  A分量系数 (a0-a19)
A41-A60:  B分量系数 (a0-a19)
```

#### 图表显示区域
图表将在以下区域生成：
```
起始位置: 第25行，B列 (B25)
布局: 3×3网格
每个图表: 300×200像素
间距: 每个图表间隔5列12行
```

## 多项式系数含义

### 2阶多项式 (每个LAB分量10个系数)
```
f(x1,x2,x3) = a0 + a1*x1 + a2*x2 + a3*x3 + 
              a4*x1² + a5*x2² + a6*x3² + 
              a7*x1*x2 + a8*x1*x3 + a9*x2*x3
```

### 3阶多项式 (每个LAB分量20个系数)  
```
f(x1,x2,x3) = [2阶项] +
              a10*x1³ + a11*x2³ + a12*x3³ +
              a13*x1²*x2 + a14*x1²*x3 + a15*x2²*x1 + 
              a16*x2²*x3 + a17*x3²*x1 + a18*x3²*x2 + 
              a19*x1*x2*x3
```

## 示例数据填充

### 宏按钮工作表示例
```
G14: 45.2    (X1最优值)
H14: 23.8    (X2最优值)  
I14: 31.0    (X3最优值)

D17: 72.5    (L目标值)
E17: -2.1    (A目标值)
F17: 14.8    (B目标值)

A19: 0.5     (ΔL值)
B19: 0.2     (ΔA值)
C19: -0.3    (ΔB值)
```

### 范围工作表系数示例 (2阶多项式)
```
A1:  50.234   (L分量 a0)
A2:  0.145    (L分量 a1)  
A3: -0.089    (L分量 a2)
A4:  0.056    (L分量 a3)
A5: -0.002    (L分量 a4)
...
A11: -1.234   (A分量 a0)
A12:  0.067   (A分量 a1)
...
A21: 12.567   (B分量 a0)
A22: -0.023   (B分量 a1)
...
```

## 图表输出布局

生成的9个图表将按以下方式排列：

```
        X1列      X2列      X3列
L行   | L vs X1 | L vs X2 | L vs X3 |
A行   | A vs X1 | A vs X2 | A vs X3 |  
B行   | B vs X1 | B vs X2 | B vs X3 |
```

每个图表包含：
- **蓝色实线**: 原始拟合曲线
- **红色虚线**: 目标偏移曲线  
- **绿色圆点**: 最优配方点
- **图表标题**: "L值 vs X1" 等
- **坐标轴标签**: X轴为配方变量，Y轴为LAB分量
- **图例**: 区分三种数据系列

## 数据验证清单

在运行宏之前，请确认：

- [ ] 宏按钮和范围工作表都存在
- [ ] G14-I14包含非零最优配方值
- [ ] D17-F17包含目标LAB值  
- [ ] A19-C19包含ΔLAB值
- [ ] 范围工作表A列包含正确数量的系数
- [ ] 所有数值数据格式正确（非文本）
- [ ] 工作表名称完全匹配（注意中文字符）

## 故障排除

### 数据问题
- 检查单元格是否包含公式而非数值
- 验证数据类型（应为数值型）
- 确认没有隐藏字符或空格

### 工作表问题  
- 确保工作表名称完全匹配
- 检查是否有隐藏或保护的工作表
- 验证工作表标签颜色不影响识别

### 系数问题
- 确认系数顺序正确
- 检查是否有缺失的系数值
- 验证多项式阶数与系数数量匹配